# by Christian Meesters, Johannes Gutenberg-University Mainz

easyblock = "CmdCp"

name = "rmats-turbo"
version = "4.1.1"

homepage = "https://github.com/Xinglab/rmats-turbo"
description = "rMATS turbo is the C/Cython version of rMATS (refer to http://rnaseq-mats.sourceforge.net). The major difference between rMATS turbo and rMATS is speed and space usage. rMATS turbo is 100 times faster and the output file is 1000 times smaller than rMATS. These advantages make analysis and storage of a large scale dataset easy and convenient."

toolchain = {"name": "GCCcore", "version": "10.2.0"}

source_urls = ["https://gitlab.com/Xinglab/archive/refs/tags/"]
sources = ["v%(version)s.tar.gz"]
patches = ["rmats-turbo-4.1.1.patch"]
checksums = [
    "cdfde24b68be0b41b4ca43e5414d3c292deb7efd617d7ee2315e2d6e6bcb1c92",
    "f42aef1730592d821e8d75557c9b4dc2eb5c226edd6b9064fdd93afb9f2e960d",
]

builddependencies = [("CMake", "3.18.4")]

dependencies = [
    ("Python", "3.8.6"),
    ("SciPy-bundle", "2020.11", "", ("foss", "2020b")),
    ("OpenBLAS", "0.3.12", "", ("GCC", "10.2.0")),
    ("ScaLAPACK", "2.1.0", "", ("gompi", "2020b")),
    ("GSL", "2.6", "", ("GCC", "10.2.0")),
    ("SAMtools", "1.12", "", ("GCC", "10.2.0")),
    ("STAR", "2.7.8a", "", ("GCC", "10.2.0")),
]

# build_cmd = "cd rmats-turbo-%(version)s && ./build_rmats --no-paired-model"
cmds_map = [(".*", " ./build_rmats --no-paired-model")]

files_to_copy = [
    (["rMATS_C/rMATSexe"], "rMATS_C"),
    (
        [
            "rMATS_P",
            "rMATS_R",
            "rmats.py",
            "rMATS_pipeline/build/lib.linux-x86_64-3.*/rmats/*.so",
        ],
        "",
    ),
    (["tests"], ""),
]

sanity_check_commands = ["python %(installdir)s/rmats.py -h"]
sanity_check_paths = {
    "files": [
        "rMATS_C/rMATSexe",
        "rMATS_P/FDR.py",
        "rMATS_P/inclusion_level.py",
        "rMATS_P/joinFiles.py",
        "rMATS_P/paste.py",
        "rMATS_R/paired_model.R",
        "rmats.py",
        "rmatspipeline.cpython-38-x86_64-linux-gnu.so",
    ],
    "dirs": ["rMATS_C", "rMATS_R", "rMATS_P", "tests"],
}

usage = "python $EBROOOTRMATSMINTURBO/rmats.py ..."

moduleclass = "bio"

buildstats = [
    {
        "build_time": 149.82,
        "command_line": [
            "--add-system-to-minimal-toolchains",
            "--buildpath='/dev/shm'",
            "--configfiles='/cluster/easybuild/config.cfg'",
            "--containerpath='/cluster/easybuild/containers'",
            "--filter-deps='adwaita-icon-theme,Autoconf,Autogen,Automake,Autotools,babl,binutils,Bison,byacc,bzip2,cairo,Coreutils,cURL,DBus,dbus-glib,Doxygen,Dyninst,Exiv2,expat,flex,FLTK,fontconfig,fontsproto,freeglut,freetype,FTGL,glibc,gc,Gdk-Pixbuf,GEGL,gettext,gexiv2,Ghostscript,GL2PS,GLEW,GLPK,glproto,GMP,GObject-Introspection,GPC,gperfguile,GraphicsMagick,gsettings-desktop-schemas,GTI,GTK+,GtkSourceView,GTS,Guile,HarfBuzz,help2man,hwloc,inputproto,intltool,itstool,jhbuild,kbproto,libcroco,libctl,libdap,libdrm,libdwarf,libelf,libepoxy,libevent,libffi,libfontenc,libgeotiff,libglade,libGLU,libICE,libidn,Libint,libmypaint,libpciaccess,libpthread-stubs,libreadline,librsvg,libSM,libunistring,libunwind,LibUUID,libX11,libXau,libXaw,libxml2,libxcb,libXcursor,libXdamage,libXdmcp,libXext,libXfixes,libXfont,libXft,libXi,libXinerama,libxkbcommon,libXmu,libXpm,libXrandr,libXrender,libxslt,libXt,libXtst,libyaml,LittleCMS,M4,makedepend,Mesa,motif,ncurses,nettle,numactl,nvidia,PCRE,PDT,pixman,pkgconfig,pkg-config,popt,pscom,PyCairo,PyGObject,qt,Qt,Qt5,randrproto,recordproto,renderproto,S-Lang,texinfo,Tk,util-linux,wget,wxPropertyGrid,xbitmaps,xcb-proto,xcb-util,xcb-util-image,xcb-util-keysyms,xcb-util-renderutil,xcb-util-wm,xextproto,xineramaproto,X11,XKeyboardConfig,XML-Parser,xorg-macros,XZ,Yasm,YAXT,zlib,Tcl,Pango'",
            "--force",
            "--group-writable-installdir",
            "--hide-deps='x264,x265,LAME,g2lib,g2clib,libmatheval,LibTIFF,OpenJPEG,libjpeg-turbo,libpng,Tcl,libtool'",
            "--include-easyblocks='/cluster/easybuild/customeasyblocks/*.py'",
            "--installpath='/cluster/easybuild'",
            "--minimal-build-env='CC:gcc,CXX:g++,CFLAGS:-march=core-avx2'",
            "--minimal-toolchains",
            "--module-naming-scheme='CategorizedModuleNamingScheme'",
            "--module-syntax='Tcl'",
            "--optarch='{\\'GCC\\': \\'march=broadwell -mtune=broadwell\\', \\'dummy\\': \\'march=core-avx2\\', \\'Intel\\': \\'xCORE-AVX2\\', \\'PGI\\': \\'tp=haswell\\'}'",
            "--packagepath='/cluster/easybuild/packages'",
            "--parallel='40'",
            "--prefix='/cluster/easybuild'",
            "--read-only-installdir",
            "--repository='GitRepository'",
            "--repositorypath='/cluster/easybuild/broadwell/easyconfigs_broadwell.git'",
            "--robot-paths='/cluster/easybuild/broadwell/easyconfigs_broadwell:'",
            "--set-gid-bit",
            "--sourcepath='/cluster/easybuild/sources'",
            "--subdir-modules='broadwell/modules'",
            "--subdir-software='broadwell/software'",
            "--tmpdir='/cluster/easybuild/tmp'",
            "--umask='002'",
            "./rmats.eb",
        ],
        "core_count": 40,
        "cpu_arch": "x86_64",
        "cpu_arch_name": "UNKNOWN",
        "cpu_model": "Intel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHz",
        "cpu_speed": 3100.0,
        "cpu_vendor": "Intel",
        "easybuild-easyblocks_version": "4.3.4",
        "easybuild-framework_version": "4.3.4",
        "gcc_version": "Using built-in specs.; COLLECT_GCC=gcc; COLLECT_LTO_WRAPPER=/cluster/easybuild/broadwell/software/GCCcore/10.2.0/libexec/gcc/x86_64-pc-linux-gnu/10.2.0/lto-wrapper; Target: x86_64-pc-linux-gnu; Configured with: ../configure --enable-languages=c,c++,fortran,d --enable-lto --enable-checking=release --disable-multilib --enable-shared=yes --enable-static=yes --enable-threads=posix --enable-plugins --enable-gold=default --enable-ld --with-plugin-ld=ld.gold --prefix=/cluster/easybuild/broadwell/software/GCCcore/10.2.0 --with-local-prefix=/cluster/easybuild/broadwell/software/GCCcore/10.2.0 --enable-bootstrap --with-isl=/dev/shm/GCCcore/10.2.0/system-system/gcc-10.2.0/stage2_stuff --build=x86_64-pc-linux-gnu --host=x86_64-pc-linux-gnu; Thread model: posix; Supported LTO compression algorithms: zlib; gcc version 10.2.0 (GCC) ; ",
        "glibc_version": "2.28",
        "hostname": "login22.mogon",
        "install_size": 13406162,
        "modules_tool": ("Lmod", "/cluster/modules/lmod/8.4/libexec/lmod", "8.4"),
        "os_name": "centos linux",
        "os_type": "Linux",
        "os_version": "8.2.2004",
        "platform_name": "x86_64-unknown-linux",
        "python_version": "3.6.8 (default, Apr 16 2020, 01:36:27) ; [GCC 8.3.1 20191121 (Red Hat 8.3.1-5)]",
        "system_gcc_path": "/cluster/easybuild/broadwell/software/GCCcore/10.2.0/bin/gcc",
        "system_python_path": "/cluster/easybuild/broadwell/software/Python/3.8.6-GCCcore-10.2.0/bin/python",
        "timestamp": 1619792967,
        "total_memory": 128555,
    }
]
